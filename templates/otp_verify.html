<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>التحقق من الكود | Beauty Salon</title>

    <style>
        *{margin:0;padding:0;box-sizing:border-box;}

        :root{
            --wave-bg:linear-gradient(180deg,#5a00e6,#8a2bff,#c77aff,#f3cbff);
            --card-bg:rgba(255,255,255,.18);
            --mint:#00d5c3;
            --mint-hover:#00c5b4;
        }

        body{
            font-family:"Tajawal",sans-serif;
            min-height:100vh;
            display:flex;
            justify-content:center;
            align-items:center;
            background:var(--wave-bg);
            color:#fff;
            overflow:hidden;
            position:relative;
            padding:20px 0;
        }

        .waves{
            position:absolute;bottom:0;width:100%;opacity:.40;z-index:-1;
        }
        .waves svg{width:100%;}

        .back-btn{
            position:absolute;top:18px;right:18px;
            width:40px;height:40px;border-radius:50%;
            display:flex;align-items:center;justify-content:center;
            border:none;font-size:18px;color:#fff;
            background:rgba(255,255,255,.14);backdrop-filter:blur(8px);
            box-shadow:0 4px 12px rgba(0,0,0,.25);
            cursor:pointer;transition:.25s;
        }
        .back-btn:hover{background:rgba(255,255,255,.22);transform:translateY(-2px);}

        .center-wrapper{
            width:100%;max-width:440px;
            text-align:center;
            display:flex;flex-direction:column;
            align-items:center;
            gap:16px;
            animation:fadeUp .7s ease;
        }

        .logo-block{animation:fadeLogo 1s ease;}
        .logo-icon svg{
            width:64px;height:64px;fill:#fff;
            filter:drop-shadow(0 4px 12px rgba(0,0,0,.25));
        }
        .logo-title{font-size:32px;font-weight:800;margin-top:10px;}
        .logo-sub{font-size:13px;letter-spacing:3px;opacity:.85;margin-top:-4px;}

        .verify-card{
            width:100%;padding:32px 26px;
            background:var(--card-bg);
            border-radius:26px;
            backdrop-filter:blur(18px);
            box-shadow:0 10px 32px rgba(0,0,0,.25);
            animation:fadeUp 1s ease;
        }

        h2{font-size:25px;font-weight:800;margin-bottom:8px;}
        .subtitle{font-size:15px;opacity:.95;margin-bottom:22px;}

        .otp-boxes{
            display:flex;
            justify-content:center;
            gap:14px;
            margin:22px 0;
        }

        .otp-input{
            width:60px;
            height:60px;
            border:none;
            border-radius:18px;
            text-align:center;
            font-size:28px;
            font-weight:700;
            color:#333;
            background:#fff;
            box-shadow:
                0 4px 10px rgba(0,0,0,.12),
                inset 0 2px 4px rgba(0,0,0,.06);
            transition:.25s;
        }

        .otp-input.pop{
            animation:pulse .25s ease;
        }

        @keyframes pulse{
            0%{transform:scale(1);}
            50%{transform:scale(1.12);}
            100%{transform:scale(1);}
        }

        .btn-submit{
            width:100%;height:54px;border:none;
            background:var(--mint);color:#fff;
            border-radius:18px;font-size:18px;font-weight:700;
            cursor:pointer;transition:.25s;
            box-shadow:0 6px 14px rgba(0,0,0,.15);
        }
        .btn-submit:hover{
            background:var(--mint-hover);
            transform:translateY(-2px);
        }

        .error-text{color:#ffdcdc;margin-top:8px;min-height:20px;font-size:13px;}

        @media(max-width:480px){
            body{justify-content:center !important;align-items:center !important;}
            .center-wrapper{width:88%;}
            .logo-icon svg{width:54px;height:54px;}
            .logo-title{font-size:27px;}
            .verify-card{padding:26px 20px;border-radius:22px;}
            .otp-input{width:54px;height:54px;font-size:24px;}
            .btn-submit{height:50px;font-size:16px;border-radius:16px;}
        }

        @keyframes fadeUp{0%{opacity:0;transform:translateY(25px);}100%{opacity:1;transform:translateY(0);}}
        @keyframes fadeLogo{0%{opacity:0;transform:translateY(-15px) scale(.95);}100%{opacity:1;transform:translateY(0) scale(1);}}
    </style>
</head>

<body>

<button class="back-btn" onclick="window.location.href='/accounts/login/'">←</button>

<div class="center-wrapper">

    <div class="logo-block">
        <div class="logo-icon">
            <svg viewBox="0 0 64 64">
                <path d="M32 4c-4 6-6 10-6 14s2 8 6 8 6-4 6-8-2-8-6-14zm0 20c-6-4-10-6-14-6s-8 2-8 6 4 6 8 6 8-2 14-6zm0 0c6-4 10-6 14-6s8 2 8 6-4 6-8 6-8-2-14-6zm0 4c-4 6-6 10-6 14s2 8 6 8 6-4 6-8-2-8-6-14z"/>
            </svg>
        </div>
        <div class="logo-title">Beauty Salon</div>
        <div class="logo-sub">VERIFY</div>
    </div>

    <div class="verify-card">
        <h2>إدخال رمز التحقق</h2>
        <p class="subtitle">تم إرسال الكود إلى رقمك. الرجاء إدخال الكود المكون من 4 أرقام.</p>

        <div class="otp-boxes">
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
        </div>

        <div id="otp-error" class="error-text"></div>

        <button class="btn-submit" onclick="submitOTP()">تحقق</button>

    </div>
</div>

<div class="waves">
    <svg viewBox="0 0 1440 320">
        <path fill="#ffffff" fill-opacity="0.33"
              d="M0,128L80,144C160,160,320,192,480,176C640,160,800,96,960,74.7C1120,53,1280,75,1360,85.3L1440,96V320H0Z"></path>
    </svg>
</div>

<script>

    const fixedOTP = "1321";
    const fields = document.querySelectorAll(".otp-input");
    const err = document.getElementById("otp-error");
    const phone = new URLSearchParams(window.location.search).get("phone");

    // ✨ تعبئة تلقائية مع الأنيميشن
    document.addEventListener("DOMContentLoaded", () => {
        fields.forEach((f, i) => {
            setTimeout(() => {
                f.value = fixedOTP[i];
                f.classList.add("pop");
            }, 180 * i);
        });
    });

    function getCode(){
        return [...fields].map(f => f.value).join("");
    }

    function submitOTP(){
        const code = getCode();

        if(code !== fixedOTP){
            err.textContent = "رمز التحقق غير صحيح.";
            return;
        }

        fetch("/accounts/verify/", {
            method: "POST",
            headers:{
                "Content-Type":"application/json",
                "X-CSRFToken": getCookie("csrftoken")
            },
            body: JSON.stringify({ phone, code })
        })
        .then(r => r.json())
        .then(d =>{
            if(d.error){
                err.textContent = d.error;
                return;
            }

            // ✔ الذهاب للداشبورد
            window.location.href = "/accounts/dashboard/";
        });
    }

    function getCookie(name){
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if(parts.length === 2) return parts.pop().split(";").shift();
        return "";
    }

</script>

</body>
</html>
