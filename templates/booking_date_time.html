<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>اختيار التاريخ والوقت | Beauty Salon</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
:root{
  --p1:#4b00c8; --p2:#7a1dff; --p3:#c77aff;
  --mint:#00d5c3; --m-h:#00c5b4;
  --pill:rgba(0,0,0,.35); --w:#fff;
}

body{
  font-family:"Tajawal",sans-serif;
  min-height:100vh;
  display:flex;justify-content:center;
  padding:28px 16px 40px;
  background:linear-gradient(150deg,var(--p1),var(--p2) 50%,var(--p3));
  animation:fIn .7s ease;
  color:var(--w);
}
@keyframes fIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}

@media(min-width:850px){
  body{padding-top:60px;}
  .screen{margin-right:auto;margin-left:auto;}
  .back-btn{right:calc(50% - 215px);}
}

.screen{width:100%;max-width:430px;position:relative;}

.back-btn{
  position:absolute;top:14px;right:14px;
  width:46px;height:46px;border-radius:16px;
  background:rgba(255,255,255,.18);
  display:flex;align-items:center;justify-content:center;
  border:none;color:#fff;font-size:20px;
  cursor:pointer;transition:.25s;
  box-shadow:0 12px 30px rgba(0,0,0,.28);
  backdrop-filter:blur(12px);
}
.back-btn:hover{background:rgba(255,255,255,.28);transform:translateY(-2px);}

.header{text-align:center;margin:70px 0 16px;}
.logo-icon{
  width:54px;height:54px;margin:auto;
  background:rgba(255,255,255,.14);
  border-radius:20px;
  display:flex;align-items:center;justify-content:center;
  animation:pop .55s ease;
  box-shadow:0 12px 30px rgba(0,0,0,.25);
}
@keyframes pop{from{opacity:0;transform:scale(.7);}to{opacity:1;transform:scale(1);}}
.logo-icon svg{width:26px;height:26px;fill:#fff;}
.logo-title{font-size:22px;font-weight:800;margin-top:6px;}
.logo-sub{font-size:11px;opacity:.7;letter-spacing:4px;margin-top:-2px;}

.step-title{text-align:center;margin-bottom:14px;}
.step-title h2{font-size:23px;font-weight:800;margin-bottom:4px;}
.step-title p{opacity:.85;font-size:14px;}

.calendar-card{
  background:#fff;color:#1b1360;
  border-radius:26px;padding:20px;margin-top:8px;
  box-shadow:0 18px 42px rgba(0,0,0,.28);
}
.cal-header{
  display:flex;justify-content:space-between;align-items:center;
  font-size:17px;font-weight:700;margin-bottom:12px;
}
.cal-nav-btn{
  background:none;border:none;color:#5a4ab5;
  font-size:22px;cursor:pointer;transition:.2s;
}
.cal-nav-btn:hover{transform:scale(1.15);}

.cal-grid{
  display:grid;grid-template-columns:repeat(7,1fr);
  text-align:center;font-size:13px;gap:4px;
}
.cal-day-name{opacity:.75;font-weight:600;padding:5px 0;}
.cal-day{
  padding:8px 0;border-radius:50%;cursor:pointer;transition:.2s;
}
.cal-day:hover{background:#ece6ff;}
.cal-day.selected{
  background:var(--p2);color:#fff;
  transform:scale(1.1);
  box-shadow:0 6px 15px rgba(122,29,255,.45);
}

.times-section{text-align:center;margin-top:22px;}
.times-section h3{font-size:17px;margin-bottom:12px;}
.times-grid{
  display:flex;flex-wrap:wrap;justify-content:center;gap:12px;
}

.time-pill{
  padding:10px 18px;border-radius:999px;
  background:var(--pill);color:#fff;
  border:none;cursor:pointer;transition:.25s;
  box-shadow:0 12px 26px rgba(0,0,0,.32);
}
.time-pill:hover{transform:translateY(-2px);background:rgba(255,255,255,.22);}
.time-pill.selected{
  background:var(--p2);
  transform:translateY(-2px) scale(1.06);
  box-shadow:0 16px 32px rgba(0,0,0,.40);
}
.time-pill.disabled{
  opacity:.30;cursor:not-allowed;
  box-shadow:none;transform:none !important;
}

.confirm-btn{
  width:100%;padding:15px;border-radius:999px;
  border:none;margin:28px 0 12px;
  font-size:17px;font-weight:800;
  background:var(--mint);color:#003c3a;
  opacity:.40;cursor:not-allowed;transition:.25s;
}
.confirm-btn.ready{
  opacity:1;cursor:pointer;
  box-shadow:0 16px 32px rgba(0,0,0,.38);
}
.confirm-btn.ready:hover{background:var(--m-h);transform:translateY(-1px);}

.bottom-back{text-align:center;opacity:.9;font-size:14px;cursor:pointer;margin-top:4px;}
</style>
</head>

<body>
<div class="screen">

<button class="back-btn" onclick="history.back()">←</button>

<div class="header">
  <div class="logo-icon">
    <svg viewBox="0 0 64 64"><path d="M32 4c-4 6-6 10-6 14s2 8 6 8 6-4 6-8-2-8-6-14zm0 20c-6-4-10-6-14-6s-8 2-8 6 4 6 8 6 8-2 14-6zm0 0c6-4 10-6 14-6s8 2 8 6-4 6-8 6-8-2-14-6zm0 4c-4 6-6 10-6 14s2 8 6 8 6-4 6-8-2-8-6-14z"/></svg>
  </div>
  <div class="logo-title">Beauty Salon</div>
  <div class="logo-sub">BEAUTY</div>
</div>

<div class="step-title">
  <h2>اختيار التاريخ والوقت</h2>
  <p>اختاري التاريخ والوقت المناسبين لحجز الموعد</p>
</div>

<form method="POST" action="{% url 'bookings:customer_info' %}">
  {% csrf_token %}

  <!-- التقويم -->
  <div class="calendar-card">
    <div class="cal-header">
      <button type="button" class="cal-nav-btn" onclick="prevMonth()">‹</button>
      <span id="monthLabel">—</span>
      <button type="button" class="cal-nav-btn" onclick="nextMonth()">›</button>
    </div>
    <div class="cal-grid" id="calendarGrid"></div>
  </div>

  <!-- الأوقات -->
  <div class="times-section">
    <h3>الأوقات المتاحة</h3>
    <div class="times-grid" id="timesGrid">
      {% for t in available_times %}
      <button type="button" class="time-pill">{{ t }}</button>
      {% endfor %}
    </div>
  </div>

  <input type="hidden" name="selected_date" id="selectedDateInput">
  <input type="hidden" name="selected_time" id="selectedTimeInput">

  <button class="confirm-btn" id="confirmBtn" disabled>تأكيد الحجز</button>
</form>

<div class="bottom-back" onclick="history.back()">← رجوع</div>

</div>

<script>
// ========== التقويم ==========
let current = new Date();
let selectedDateIso = null;
let selectedTime = null;

const grid = document.getElementById("calendarGrid");
const monthLabel = document.getElementById("monthLabel");
const confirmBtn = document.getElementById("confirmBtn");
const timesButtons = document.querySelectorAll(".time-pill");

const bookedSlots = {
  // أمثلة لأيام محجوزة (تقدرين تغيرينها)
  // "2025-12-06": ["٩:٣٠ ص","١١:٠٠ ص"],
};

function renderCalendar(){
  grid.innerHTML = "";
  const y = current.getFullYear();
  const m = current.getMonth();
  monthLabel.textContent = current.toLocaleString("ar", { month:"long", year:"numeric" });

  const first = new Date(y,m,1).getDay();
  const days = new Date(y,m+1,0).getDate();

  const names = ["أحد","إثن","ثلث","أربع","خميس","جمعة","سبت"];
  names.forEach(n => {
    const el = document.createElement("div");
    el.className = "cal-day-name";
    el.textContent = n;
    grid.appendChild(el);
  });

  for(let i=0;i<first;i++){
    const empty = document.createElement("div");
    grid.appendChild(empty);
  }

  for(let d=1; d<=days; d++){
    const el = document.createElement("div");
    el.className = "cal-day";
    el.textContent = d;

    el.onclick = () => {
      document.querySelectorAll(".cal-day").forEach(x=>x.classList.remove("selected"));
      el.classList.add("selected");
      const monthNum = String(m+1).padStart(2,"0");
      const dayNum = String(d).padStart(2,"0");
      selectedDateIso = `${y}-${monthNum}-${dayNum}`;
      document.getElementById("selectedDateInput").value = selectedDateIso;
      updateTimesForDate();
      checkReady();
    };

    grid.appendChild(el);
  }
}

function prevMonth(){ current.setMonth(current.getMonth()-1); renderCalendar(); selectedDateIso=null; resetTimes(); checkReady(); }
function nextMonth(){ current.setMonth(current.getMonth()+1); renderCalendar(); selectedDateIso=null; resetTimes(); checkReady(); }

renderCalendar();

// ========== الأوقات ==========
function resetTimes(){
  timesButtons.forEach(btn=>{
    btn.classList.remove("selected","disabled");
    btn.disabled = false;
  });
  selectedTime = null;
  document.getElementById("selectedTimeInput").value = "";
}

function updateTimesForDate(){
  resetTimes();
  if (!selectedDateIso) return;

  const booked = bookedSlots[selectedDateIso] || [];
  timesButtons.forEach(btn=>{
    const label = btn.textContent.trim();
    if (booked.includes(label)){
      btn.classList.add("disabled");
      btn.disabled = true;
    }
  });
}

timesButtons.forEach(btn=>{
  btn.onclick = () => {
    if (btn.classList.contains("disabled")) return;
    timesButtons.forEach(t=>t.classList.remove("selected"));
    btn.classList.add("selected");
    selectedTime = btn.textContent.trim();
    document.getElementById("selectedTimeInput").value = selectedTime;
    checkReady();
  }
});

// ========== تفعيل زر التأكيد ==========
function checkReady(){
  if (selectedDateIso && selectedTime){
    confirmBtn.disabled = false;
    confirmBtn.classList.add("ready");
  }else{
    confirmBtn.disabled = true;
    confirmBtn.classList.remove("ready");
  }
}
</script>

</body>
</html>
